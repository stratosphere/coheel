#!/usr/bin/env /bin/sh

if [ $# -eq 0 ]
then
	echo "Usage:"
	echo "  bin/run [dataset] [program] [params]"
	echo "Available datasets:"
	echo "    full (Results from the last run)"
	echo "    full_run (Results from a run on the full dataset)"
	echo "    chunk"
	echo "Available programs:"
	echo "    main"
	echo "    trie"
	echo "    redirects"
	echo "Available params:"
	echo "    -log: turns on Flink logging"
	exit
fi

if [ -e "src/main/resources/$1.conf" ]
then
	rm run-output compile-output 2> /dev/null
	date --rfc-3339=seconds | tee -a run-output
	cp src/main/resources/$1.conf src/main/resources/application.conf
	echo "Compiling .."
	mvn compile > compile-output
	echo "Running .."
	echo "--------------------------------------------------------------------------" | tee -a run-output
	mvn -q scala:run -DaddArgs="$2|$3" | tee -a run-output
	echo "--------------------------------------------------------------------------" | tee -a run-output
	date --rfc-3339=seconds | tee -a run-output
else
	echo "Configuration '$1' does not exist."
	echo "Available configurations:"
	cd src/main/resources
	ls *.conf
	cd ../../..
fi
